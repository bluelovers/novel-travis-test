"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const moment = require("moment");
const path = require("upath2");
const crlf_normalize_1 = require("crlf-normalize");
const fs = require("fs-extra");
const gitlog2_1 = require("gitlog2");
const __1 = require("..");
const index_1 = require("../index");
const log_1 = require("../lib/log");
const share_1 = require("../lib/share");
const cross_spawn_1 = require("./git/cross-spawn");
const init_1 = require("./init");
exports.DATE_FORMAT = 'YYYY-MM-DD-HH-mm-ss';
/**
 * Created by user on 2018/5/17/017.
 */
function pushGit(REPO_PATH, repo, force) {
    let argv = [
        'push',
        '--progress',
        force ? '--force' : undefined,
        repo,
    ];
    argv = argv.filter(v => v);
    if (init_1.NO_PUSH) {
        return null;
    }
    log_1.default.debug(`嘗試推送 ${repo}`);
    let cp = __1.crossSpawnSync('git', argv, {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
    return cp;
}
exports.pushGit = pushGit;
function pullGit(REPO_PATH) {
    return __1.crossSpawnSync('git', [
        'pull',
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.pullGit = pullGit;
function fetchGit(REPO_PATH) {
    return cross_spawn_1.crossSpawnSyncGit('git', [
        'fetch',
        '--force',
        'origin',
        'master',
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.fetchGit = fetchGit;
function fetchGitAll(REPO_PATH) {
    return cross_spawn_1.crossSpawnSyncGit('git', [
        'fetch',
        '--all',
        '--prune',
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.fetchGitAll = fetchGitAll;
function newBranch(REPO_PATH, BR_NAME) {
    log_1.default.debug(`嘗試建立新分支 ${BR_NAME}`);
    return __1.crossSpawnSync('git', [
        'checkout',
        '-B',
        BR_NAME,
        'origin/master',
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.newBranch = newBranch;
function currentBranchName(REPO_PATH) {
    let cp = __1.crossSpawnSync('git', [
        'rev-parse',
        '--abbrev-ref',
        'HEAD',
    ], {
        cwd: REPO_PATH,
    });
    let name = index_1.crossSpawnOutput(cp.stdout);
    return name;
}
exports.currentBranchName = currentBranchName;
function deleteBranch(REPO_PATH, name, force) {
    if (name == 'master' || !name) {
        throw new Error();
    }
    log_1.default.debug(`嘗試刪除本地分支 ${name}`);
    return __1.crossSpawnSync('git', [
        'branch',
        force ? '-D' : '-d',
        name,
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.deleteBranch = deleteBranch;
/**
 * @FIXME 不知道為什麼沒有刪除 所以多做一次另外一種刪除步驟
 */
function deleteBranchRemote(REPO_PATH, remote, name, force) {
    if (name == 'master' || !name || !remote) {
        throw new Error();
    }
    log_1.default.debug(`嘗試刪除遠端分支 ${name}`);
    __1.crossSpawnSync('git', [
        'push',
        remote,
        '--delete',
        name,
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
    /**
     * 不知道為什麼沒有刪除 所以多做一次另外一種刪除步驟
     * https://zlargon.gitbooks.io/git-tutorial/content/remote/delete_branch.html
     */
    __1.crossSpawnSync('git', [
        'push',
        remote,
        ':' + name,
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.deleteBranchRemote = deleteBranchRemote;
function oldBranch(REPO_PATH) {
    let name = currentBranchName(REPO_PATH);
    if (name.indexOf('auto/') == 0) {
        return name;
    }
    return null;
}
exports.oldBranch = oldBranch;
function diffOrigin(REPO_PATH) {
    let log = gitlog2_1.default({
        repo: REPO_PATH,
        branch: [currentBranchName(REPO_PATH), 'origin/master'].join('..'),
        number: 3,
        nameStatus: false,
    });
    log_1.default.log(log, log.length);
    return log.length;
}
exports.diffOrigin = diffOrigin;
function getHashHEAD(REPO_PATH, branch = 'HEAD') {
    return gitlog2_1.default({ repo: REPO_PATH, number: 1, branch })[0].abbrevHash;
}
exports.getHashHEAD = getHashHEAD;
function getPushUrl(url, login_token) {
    if (login_token && !/@$/.test(login_token)) {
        login_token += '@';
    }
    return `https://${login_token ? login_token : ''}${url}`;
}
exports.getPushUrl = getPushUrl;
function getPushUrlGitee(url, login_token = init_1.GITEE_TOKEN) {
    return getPushUrl(url, login_token);
}
exports.getPushUrlGitee = getPushUrlGitee;
function createGit(options) {
    const wait_create_git = share_1.shareStates(share_1.EnumShareStates.WAIT_CREATE_GIT);
    wait_create_git.ensure();
    let targetName = path.basename(options.targetPath);
    let targetPath = path.normalize(options.targetPath);
    let REPO_PATH = targetPath;
    let exists = fs.pathExistsSync(REPO_PATH) && index_1.isGitRoot(REPO_PATH);
    let data = {
        targetName,
        targetPath,
        newBranchName: options.newBranchName,
        exists,
        existsBranchName: exists && oldBranch(REPO_PATH) || null,
        NOT_DONE: init_1.NOT_DONE,
        url: options.url,
        urlClone: options.urlClone,
        LOGIN_TOKEN: options.LOGIN_TOKEN,
        pushUrl: options.urlPush || getPushUrl(options.url, options.LOGIN_TOKEN),
    };
    let temp = {
        cp: null,
    };
    let label;
    log_1.default.info(`create git: ${targetName}`);
    if (options.on && options.on.create_before) {
        label = `--- CREATE_BEFORE ---`;
        log_1.default.info(label);
        log_1.default.time(label);
        options.on.create_before(data, temp);
        log_1.default.timeEnd(label);
    }
    label = `--- CREATE ---`;
    log_1.default.info(label);
    log_1.default.time(label);
    temp.cp = null;
    let _deleted;
    if (data.NOT_DONE && data.exists) {
        log_1.default.warn(`${targetName} already exists`);
        temp.cp = fetchGit(data.targetPath);
    }
    else if (data.exists) {
        log_1.default.warn(`${targetName} already exists`);
        log_1.default.info(`取得所有遠端分支`);
        fetchGitAll(data.targetPath);
        _deleted = gitRemoveBranchOutdate(data.targetPath);
        temp.cp = fetchGit(data.targetPath);
    }
    else {
        let CLONE_DEPTH = (options.CLONE_DEPTH || process && process.env && process.env.CLONE_DEPTH || 50);
        if (isNaN(CLONE_DEPTH) || !CLONE_DEPTH || CLONE_DEPTH <= 0) {
            CLONE_DEPTH = 50;
        }
        let urlClone = data.urlClone;
        if (!urlClone) {
            log_1.default.red(`urlClone 不存在 嘗試自動生成`);
            if (data.LOGIN_TOKEN) {
                log_1.default.debug(`使用 LOGIN_TOKEN 自動生成 urlClone`);
                urlClone = getPushUrl(data.url, data.LOGIN_TOKEN);
            }
            else {
                log_1.default.debug(`使用 url 自動生成 urlClone`);
                urlClone = getPushUrl(data.url);
            }
        }
        temp.cp = __1.crossSpawnSync('git', [
            'clone',
            `--depth=${CLONE_DEPTH}`,
            //'--verbose',
            //'--progress ',
            urlClone,
            data.targetPath,
        ], {
            stdio: 'inherit',
            cwd: init_1.PROJECT_ROOT,
        });
    }
    let _cp_error = index_1.getCrossSpawnError(temp.cp);
    if (_cp_error) {
        throw _cp_error;
    }
    if (options.on && options.on.create) {
        options.on.create(data, temp);
    }
    log_1.default.timeEnd(label);
    if (options.on && options.on.create_after) {
        label = `--- CREATE_AFTER ---`;
        log_1.default.info(label);
        log_1.default.time(label);
        options.on.create_after(data, temp);
        log_1.default.timeEnd(label);
    }
    label = `--- BEFORE_DONE ---`;
    log_1.default.info(label);
    log_1.default.time(label);
    if (_deleted) {
        gitGcAggressive(data.targetPath);
    }
    else {
        gitGc(data.targetPath);
    }
    log_1.default.timeEnd(label);
    label = `--- REMOVE_WAIT ---`;
    log_1.default.info(label);
    log_1.default.time(label);
    wait_create_git.remove();
    log_1.default.timeEnd(label);
    return { data, temp };
}
exports.createGit = createGit;
function gitGc(REPO_PATH, argv) {
    argv = filterArgv([
        'gc',
    ].concat((argv && argv.length) ? argv : []));
    if (argv.length == 1) {
        argv.push('--prune="3 days"');
    }
    log_1.default.info(`優化 GIT 資料`, argv);
    return __1.crossSpawnSync('git', argv, {
        cwd: REPO_PATH,
        stdio: 'inherit',
    });
}
exports.gitGc = gitGc;
function gitGcAggressive(REPO_PATH, argv) {
    argv = filterArgv([
        'gc',
        '--aggressive',
    ].concat((argv && argv.length) ? argv : []));
    if (argv.length == 2) {
        argv.push('--prune="3 days"');
    }
    log_1.default.info(`優化 GIT 資料`, argv);
    return __1.crossSpawnSync('git', argv, {
        cwd: REPO_PATH,
        stdio: 'inherit',
    });
}
exports.gitGcAggressive = gitGcAggressive;
function branchNameToDate(br_name) {
    return moment(br_name.replace(/^.*auto\//, ''), exports.DATE_FORMAT);
}
exports.branchNameToDate = branchNameToDate;
function gitRemoveBranchOutdate(REPO_PATH) {
    log_1.default.info(`開始分析 GIT 分支`);
    let data_ret = false;
    let br_name = currentBranchName(REPO_PATH).toString().toLowerCase();
    let date_br = branchNameToDate(br_name);
    let date_now = moment();
    //console.log({br_name, date_br, date_now});
    let brs;
    brs = parseBranchGroup(gitBranchMergedList(REPO_PATH));
    if (brs) {
        log_1.default.log(`檢查並刪除已合併分支`);
        log_1.default.dir(brs, { colors: true, });
        let pre_name;
        pre_name = 'refs/heads/';
        brs.heads
            .forEach(function (value, index, array) {
            fn(value, pre_name + value);
        });
        pre_name = 'refs/remotes/';
        Object.keys(brs.remotes)
            .forEach(function (remote_name) {
            let prefix = pre_name + remote_name + '/';
            let brs_list = brs.remotes[remote_name];
            if (brs_list.length > 5) {
                brs_list = brs_list
                    .filter(function (value) {
                    let bool = /auto\//i.test(value);
                    return bool;
                })
                    .slice(0, -2);
                brs_list
                    .forEach(function (value, index, array) {
                    let bool = !/auto\//i.test(value);
                    let del_name = prefix + value;
                    fn(value, del_name, bool, true, remote_name);
                });
            }
        });
    }
    brs = parseBranchGroup(gitBranchMergedList(REPO_PATH, true));
    if (brs) {
        log_1.default.log(`檢查並刪除未合併過期分支`);
        log_1.default.dir(brs, { colors: true, });
        let pre_name;
        pre_name = 'refs/heads/';
        brs.heads
            .forEach(function (value, index, array) {
            fn(value, pre_name + value);
        });
        pre_name = 'refs/remotes/';
        Object.keys(brs.remotes)
            .forEach(function (remote_name) {
            if (remote_name == 'origin') {
                return;
            }
            let prefix = pre_name + remote_name + '/';
            let brs_list = brs.remotes[remote_name];
            if (brs_list.length > 5) {
                let max_date_unix = 0;
                brs_list = brs_list
                    .filter(function (value) {
                    let bool = /auto\//i.test(value);
                    if (bool) {
                        let d = branchNameToDate(value);
                        //console.log(d, d.unix());
                        max_date_unix = Math.max(max_date_unix, d.unix());
                    }
                    return bool;
                })
                    .slice(0, -3);
                let max_date = moment.unix(max_date_unix);
                brs_list
                    .forEach(function (value, index, array) {
                    let bool = !/^auto\//i.test(value);
                    let del_name = prefix + value;
                    fn(value, del_name, bool, true, remote_name);
                });
            }
        });
    }
    function fn(value, del_name, skip, is_remote, remote_name) {
        let value_lc = value.toLowerCase();
        if (skip) {
            log_1.default.log(`skip (1) ${del_name}`);
            return;
        }
        else if (!value || value_lc == br_name || value_lc == 'master' || value_lc == 'head') {
            log_1.default.log(`skip (2) ${del_name}`);
            return;
        }
        else if (is_remote) {
            if (!/auto\//i.test(value) || !remote_name) {
                log_1.default.log(`skip (3) ${del_name}`);
                return;
            }
            let d = moment(value.replace(/^.*auto\//, ''), exports.DATE_FORMAT);
            //console.log(d);
        }
        log_1.default.info(`try delete ${del_name}`);
        if (is_remote) {
            deleteBranchRemote(REPO_PATH, remote_name, value);
        }
        else {
            deleteBranch(REPO_PATH, value);
        }
        data_ret = true;
    }
    return data_ret;
}
exports.gitRemoveBranchOutdate = gitRemoveBranchOutdate;
function gitBranchMergedList(REPO_PATH, noMerged, BR_NAME) {
    let cp = __1.crossSpawnSync('git', filterArgv([
        'branch',
        '--format',
        '%(refname)',
        '-a',
        noMerged ? '--no-merged' : '--merged',
        BR_NAME,
    ]), {
        cwd: REPO_PATH,
    });
    if (cp.stderr && cp.stderr.length) {
        log_1.default.error(cp.stderr.toString());
        return null;
    }
    let name = index_1.crossSpawnOutput(cp.stdout);
    return name
        .split(crlf_normalize_1.LF);
}
exports.gitBranchMergedList = gitBranchMergedList;
function filterArgv(argv) {
    return argv
        .filter(v => typeof v !== 'undefined')
        .map(v => v.trim());
}
exports.filterArgv = filterArgv;
function parseBranchGroup(r) {
    if (!r || !r.length) {
        return null;
    }
    return r.sort().reduce(function (a, b) {
        if (/^refs\/remotes\/([^\/]+)\/(.+)$/.exec(b)) {
            let { $1, $2 } = RegExp;
            a.remotes[$1] = a.remotes[$1] || [];
            a.remotes[$1].push($2);
        }
        else if (/^refs\/heads\/(.+)$/.exec(b)) {
            let { $1, $2 } = RegExp;
            a.heads.push($1);
        }
        return a;
    }, {
        heads: [],
        remotes: {
            origin: [],
        },
    });
}
exports.parseBranchGroup = parseBranchGroup;
function gitCleanAll(REPO_PATH) {
    log_1.default.info(`[git:clean] Remove untracked files from the working tree`);
    return __1.crossSpawnSync('git', [
        'clean',
        '-d',
        '-fx',
    ], {
        stdio: 'inherit',
        cwd: REPO_PATH,
    });
}
exports.gitCleanAll = gitCleanAll;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2l0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2l0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQWtDO0FBQ2xDLCtCQUFnQztBQUNoQyxtREFBb0M7QUFDcEMsK0JBQStCO0FBQy9CLHFDQUE2QjtBQUM3QiwwQkFBc0Q7QUFDdEQsb0NBQTJFO0FBQzNFLG9DQUFpQztBQUNqQyx3Q0FBNEQ7QUFFNUQsbURBQXNEO0FBRXRELGlDQUFzRTtBQUV6RCxRQUFBLFdBQVcsR0FBRyxxQkFBcUIsQ0FBQztBQUVqRDs7R0FFRztBQUVILFNBQWdCLE9BQU8sQ0FBQyxTQUFpQixFQUFFLElBQVksRUFBRSxLQUFlO0lBRXZFLElBQUksSUFBSSxHQUFHO1FBQ1YsTUFBTTtRQUNOLFlBQVk7UUFDWixLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUztRQUM3QixJQUFJO0tBQ0osQ0FBQztJQUVGLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFM0IsSUFBSSxjQUFPLEVBQ1g7UUFDQyxPQUFPLElBQUksQ0FBQztLQUNaO0lBRUQsYUFBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLENBQUM7SUFFOUIsSUFBSSxFQUFFLEdBQUcsa0JBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFO1FBQ3BDLEtBQUssRUFBRSxTQUFTO1FBQ2hCLEdBQUcsRUFBRSxTQUFTO0tBQ2QsQ0FBQyxDQUFDO0lBRUgsT0FBTyxFQUFFLENBQUM7QUFDWCxDQUFDO0FBeEJELDBCQXdCQztBQUVELFNBQWdCLE9BQU8sQ0FBQyxTQUFpQjtJQUV4QyxPQUFPLGtCQUFjLENBQUMsS0FBSyxFQUFFO1FBQzVCLE1BQU07S0FDTixFQUFFO1FBQ0YsS0FBSyxFQUFFLFNBQVM7UUFDaEIsR0FBRyxFQUFFLFNBQVM7S0FDZCxDQUFDLENBQUM7QUFDSixDQUFD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SUFFNUMsYUFBTyxDQUFDLElBQUksQ0FBQywwREFBMEQsQ0FBQyxDQUFDO0lBQ3pFLE9BQU8sa0JBQWMsQ0FBQyxLQUFLLEVBQUU7UUFDNUIsT0FBTztRQUNQLElBQUk7UUFDSixLQUFLO0tBQ0wsRUFBRTtRQUNGLEtBQUssRUFBRSxTQUFTO1FBQ2hCLEdBQUcsRUFBRSxTQUFTO0tBQ2QsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQVhELGtDQVdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKCd1cGF0aDInKTtcbmltcG9ydCB7IExGIH0gZnJvbSAnY3JsZi1ub3JtYWxpemUnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGdpdGxvZyBmcm9tICdnaXRsb2cyJztcbmltcG9ydCB7IGNyb3NzU3Bhd25TeW5jLCBTcGF3blN5bmNSZXR1cm5zIH0gZnJvbSAnLi4nO1xuaW1wb3J0IHsgY3Jvc3NTcGF3bk91dHB1dCwgaXNHaXRSb290LCBnZXRDcm9zc1NwYXduRXJyb3IgfSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQgY29uc29sZSBmcm9tICcuLi9saWIvbG9nJztcbmltcG9ydCB7IEVudW1TaGFyZVN0YXRlcywgc2hhcmVTdGF0ZXMgfSBmcm9tICcuLi9saWIvc2hhcmUnO1xuaW1wb3J0IFByb2plY3RDb25maWcgZnJvbSAnLi4vcHJvamVjdC5jb25maWcnO1xuaW1wb3J0IHsgY3Jvc3NTcGF3blN5bmNHaXQgfSBmcm9tICcuL2dpdC9jcm9zcy1zcGF3bic7XG5cbmltcG9ydCB7IEdJVEVFX1RPS0VOLCBOT19QVVNILCBOT1RfRE9ORSwgUFJPSkVDVF9ST09UIH0gZnJvbSAnLi9pbml0JztcblxuZXhwb3J0IGNvbnN0IERBVEVfRk9STUFUID0gJ1lZWVktTU0tREQtSEgtbW0tc3MnO1xuXG4vKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDE4LzUvMTcvMDE3LlxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBwdXNoR2l0KFJFUE9fUEFUSDogc3RyaW5nLCByZXBvOiBzdHJpbmcsIGZvcmNlPzogYm9vbGVhbilcbntcblx0bGV0IGFyZ3YgPSBbXG5cdFx0J3B1c2gnLFxuXHRcdCctLXByb2dyZXNzJyxcblx0XHRmb3JjZSA/ICctLWZvcmNlJyA6IHVuZGVmaW5lZCxcblx0XHRyZXBvLFxuXHRdO1xuXG5cdGFyZ3YgPSBhcmd2LmZpbHRlcih2ID0+IHYpO1xuXG5cdGlmIChOT19QVVNIKVxuXHR7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRjb25zb2xlLmRlYnVnKGDlmJfoqabmjqjpgIEgJHtyZXBvfWApO1xuXG5cdGxldCBjcCA9IGNyb3NzU3Bhd25TeW5jKCdnaXQnLCBhcmd2LCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0fSk7XG5cblx0cmV0dXJuIGNwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHVsbEdpdChSRVBPX1BBVEg6IHN0cmluZylcbntcblx0cmV0dXJuIGNyb3NzU3Bhd25TeW5jKCdnaXQnLCBbXG5cdFx0J3B1bGwnLFxuXHRdLCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaEdpdChSRVBPX1BBVEg6IHN0cmluZylcbntcblx0cmV0dXJuIGNyb3NzU3Bhd25TeW5jR2l0KCdnaXQnLCBbXG5cdFx0J2ZldGNoJyxcblx0XHQnLS1mb3JjZScsXG5cdFx0J29yaWdpbicsXG5cdFx0J21hc3RlcicsXG5cdF0sIHtcblx0XHRzdGRpbzogJ2luaGVyaXQnLFxuXHRcdGN3ZDogUkVQT19QQVRILFxuXHR9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZldGNoR2l0QWxsKFJFUE9fUEFUSDogc3RyaW5nKVxue1xuXHRyZXR1cm4gY3Jvc3NTcGF3blN5bmNHaXQoJ2dpdCcsIFtcblx0XHQnZmV0Y2gnLFxuXHRcdCctLWFsbCcsXG5cdFx0Jy0tcHJ1bmUnLFxuXHRdLCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBuZXdCcmFuY2goUkVQT19QQVRIOiBzdHJpbmcsIEJSX05BTUU6IHN0cmluZylcbntcblx0Y29uc29sZS5kZWJ1Zyhg5ZiX6Kmm5bu656uL5paw5YiG5pSvICR7QlJfTkFNRX1gKTtcblxuXHRyZXR1cm4gY3Jvc3NTcGF3blN5bmMoJ2dpdCcsIFtcblx0XHQnY2hlY2tvdXQnLFxuXHRcdCctQicsXG5cdFx0QlJfTkFNRSxcblx0XHQnb3JpZ2luL21hc3RlcicsXG5cdF0sIHtcblx0XHRzdGRpbzogJ2luaGVyaXQnLFxuXHRcdGN3ZDogUkVQT19QQVRILFxuXHR9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJlbnRCcmFuY2hOYW1lKFJFUE9fUEFUSDogc3RyaW5nKVxue1xuXHRsZXQgY3AgPSBjcm9zc1NwYXduU3luYygnZ2l0JywgW1xuXHRcdCdyZXYtcGFyc2UnLFxuXHRcdCctLWFiYnJldi1yZWYnLFxuXHRcdCdIRUFEJyxcblx0XSwge1xuXHRcdGN3ZDogUkVQT19QQVRILFxuXHR9KTtcblxuXHRsZXQgbmFtZSA9IGNyb3NzU3Bhd25PdXRwdXQoY3Auc3Rkb3V0KTtcblxuXHRyZXR1cm4gbmFtZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUJyYW5jaChSRVBPX1BBVEg6IHN0cmluZywgbmFtZTogc3RyaW5nLCBmb3JjZT86IGJvb2xlYW4pXG57XG5cdGlmIChuYW1lID09ICdtYXN0ZXInIHx8ICFuYW1lKVxuXHR7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCk7XG5cdH1cblxuXHRjb25zb2xlLmRlYnVnKGDlmJfoqabliKrpmaTmnKzlnLDliIbmlK8gJHtuYW1lfWApO1xuXG5cdHJldHVybiBjcm9zc1NwYXduU3luYygnZ2l0JywgW1xuXHRcdCdicmFuY2gnLFxuXHRcdGZvcmNlID8gJy1EJyA6ICctZCcsXG5cdFx0bmFtZSxcblx0XSwge1xuXHRcdHN0ZGlvOiAnaW5oZXJpdCcsXG5cdFx0Y3dkOiBSRVBPX1BBVEgsXG5cdH0pO1xufVxuXG4vKipcbiAqIEBGSVhNRSDkuI3nn6XpgZPngrrku4DpurzmspLmnInliKrpmaQg5omA5Lul5aSa5YGa5LiA5qyh5Y+m5aSW5LiA56iu5Yiq6Zmk5q2l6amfXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVCcmFuY2hSZW1vdGUoUkVQT19QQVRIOiBzdHJpbmcsIHJlbW90ZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIGZvcmNlPzogYm9vbGVhbilcbntcblx0aWYgKG5hbWUgPT0gJ21hc3RlcicgfHwgIW5hbWUgfHwgIXJlbW90ZSlcblx0e1xuXHRcdHRocm93IG5ldyBFcnJvcigpO1xuXHR9XG5cblx0Y29uc29sZS5kZWJ1Zyhg5ZiX6Kmm5Yiq6Zmk6YGg56uv5YiG5pSvICR7bmFtZX1gKTtcblxuXHRjcm9zc1NwYXduU3luYygnZ2l0JywgW1xuXHRcdCdwdXNoJyxcblx0XHRyZW1vdGUsXG5cdFx0Jy0tZGVsZXRlJyxcblx0XHRuYW1lLFxuXHRdLCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0fSk7XG5cblx0LyoqXG5cdCAqIOS4jeefpemBk+eCuuS7gOm6vOaykuacieWIqumZpCDmiYDku6XlpJrlgZrkuIDmrKHlj6blpJbkuIDnqK7liKrpmaTmraXpqZ9cblx0ICogaHR0cHM6Ly96bGFyZ29uLmdpdGJvb2tzLmlvL2dpdC10dXRvcmlhbC9jb250ZW50L3JlbW90ZS9kZWxldGVfYnJhbmNoLmh0bWxcblx0ICovXG5cdGNyb3NzU3Bhd25TeW5jKCdnaXQnLCBbXG5cdFx0J3B1c2gnLFxuXHRcdHJlbW90ZSxcblx0XHQnOicgKyBuYW1lLFxuXHRdLCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbGRCcmFuY2goUkVQT19QQVRIOiBzdHJpbmcpXG57XG5cdGxldCBuYW1lID0gY3VycmVudEJyYW5jaE5hbWUoUkVQT19QQVRIKTtcblxuXHRpZiAobmFtZS5pbmRleE9mKCdhdXRvLycpID09IDApXG5cdHtcblx0XHRyZXR1cm4gbmFtZTtcblx0fVxuXG5cdHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGlmZk9yaWdpbihSRVBPX1BBVEg6IHN0cmluZylcbntcblx0bGV0IGxvZyA9IGdpdGxvZyh7XG5cdFx0cmVwbzogUkVQT19QQVRILFxuXHRcdGJyYW5jaDogW2N1cnJlbnRCcmFuY2hOYW1lKFJFUE9fUEFUSCksICdvcmlnaW4vbWFzdGVyJ10uam9pbignLi4nKSxcblx0XHRudW1iZXI6IDMsXG5cdFx0bmFtZVN0YXR1czogZmFsc2UsXG5cdH0pO1xuXG5cdGNvbnNvbGUubG9nKGxvZywgbG9nLmxlbmd0aCk7XG5cblx0cmV0dXJuIGxvZy5sZW5ndGg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIYXNoSEVBRChSRVBPX1BBVEg6IHN0cmluZywgYnJhbmNoOiBzdHJpbmcgPSAnSEVBRCcpXG57XG5cdHJldHVybiBnaXRsb2coeyByZXBvOiBSRVBPX1BBVEgsIG51bWJlcjogMSwgYnJhbmNoIH0pWzBdLmFiYnJldkhhc2g7XG59XG5cbmV4cG9ydCB0eXBlIElPcHRpb25zQ3JlYXRlR2l0ID0ge1xuXHR1cmw6IHN0cmluZyxcblx0dGFyZ2V0UGF0aDogc3RyaW5nLFxuXG5cdG5ld0JyYW5jaE5hbWU6IHN0cmluZyxcblxuXHR1cmxDbG9uZT86IHN0cmluZyxcblx0dXJsUHVzaD86IHN0cmluZyxcblxuXHROT1RfRE9ORSxcblxuXHRDTE9ORV9ERVBUSD86IG51bWJlcixcblxuXHRMT0dJTl9UT0tFTj86IHN0cmluZyxcblxuXHRvbj86IHtcblx0XHRjcmVhdGVfYmVmb3JlPyhkYXRhOiBSZXR1cm5UeXBlPHR5cGVvZiBjcmVhdGVHaXQ+W1wiZGF0YVwiXSwgdGVtcD86IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUdpdD5bXCJ0ZW1wXCJdKSxcblx0XHRjcmVhdGU/KGRhdGE6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUdpdD5bXCJkYXRhXCJdLCB0ZW1wPzogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlR2l0PltcInRlbXBcIl0pLFxuXHRcdGNyZWF0ZV9hZnRlcj8oZGF0YTogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlR2l0PltcImRhdGFcIl0sIHRlbXA/OiBSZXR1cm5UeXBlPHR5cGVvZiBjcmVhdGVHaXQ+W1widGVtcFwiXSksXG5cdH0sXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHVzaFVybCh1cmw6IHN0cmluZywgbG9naW5fdG9rZW4/OiBzdHJpbmcpXG57XG5cdGlmIChsb2dpbl90b2tlbiAmJiAhL0AkLy50ZXN0KGxvZ2luX3Rva2VuKSlcblx0e1xuXHRcdGxvZ2luX3Rva2VuICs9ICdAJztcblx0fVxuXG5cdHJldHVybiBgaHR0cHM6Ly8ke2xvZ2luX3Rva2VuID8gbG9naW5fdG9rZW4gOiAnJ30ke3VybH1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHVzaFVybEdpdGVlKHVybDogc3RyaW5nLCBsb2dpbl90b2tlbjogc3RyaW5nID0gR0lURUVfVE9LRU4pXG57XG5cdHJldHVybiBnZXRQdXNoVXJsKHVybCwgbG9naW5fdG9rZW4pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlR2l0KG9wdGlvbnM6IElPcHRpb25zQ3JlYXRlR2l0KVxue1xuXHRjb25zdCB3YWl0X2NyZWF0ZV9naXQgPSBzaGFyZVN0YXRlcyhFbnVtU2hhcmVTdGF0ZXMuV0FJVF9DUkVBVEVfR0lUKTtcblxuXHR3YWl0X2NyZWF0ZV9naXQuZW5zdXJlKCk7XG5cblx0bGV0IHRhcmdldE5hbWUgPSBwYXRoLmJhc2VuYW1lKG9wdGlvbnMudGFyZ2V0UGF0aCk7XG5cdGxldCB0YXJnZXRQYXRoID0gcGF0aC5ub3JtYWxpemUob3B0aW9ucy50YXJnZXRQYXRoKTtcblxuXHRsZXQgUkVQT19QQVRIID0gdGFyZ2V0UGF0aDtcblxuXHRsZXQgZXhpc3RzID0gZnMucGF0aEV4aXN0c1N5bmMoUkVQT19QQVRIKSAmJiBpc0dpdFJvb3QoUkVQT19QQVRIKTtcblxuXHRsZXQgZGF0YSA9IHtcblx0XHR0YXJnZXROYW1lLFxuXHRcdHRhcmdldFBhdGgsXG5cblx0XHRuZXdCcmFuY2hOYW1lOiBvcHRpb25zLm5ld0JyYW5jaE5hbWUsXG5cblx0XHRleGlzdHMsXG5cdFx0ZXhpc3RzQnJhbmNoTmFtZTogZXhpc3RzICYmIG9sZEJyYW5jaChSRVBPX1BBVEgpIHx8IG51bGwsXG5cblx0XHROT1RfRE9ORSxcblxuXHRcdHVybDogb3B0aW9ucy51cmwsXG5cdFx0dXJsQ2xvbmU6IG9wdGlvbnMudXJsQ2xvbmUsXG5cblx0XHRMT0dJTl9UT0tFTjogb3B0aW9ucy5MT0dJTl9UT0tFTixcblxuXHRcdHB1c2hVcmw6IG9wdGlvbnMudXJsUHVzaCB8fCBnZXRQdXNoVXJsKG9wdGlvbnMudXJsLCBvcHRpb25zLkxPR0lOX1RPS0VOKSxcblx0fTtcblxuXHRsZXQgdGVtcDoge1xuXHRcdGNwOiBTcGF3blN5bmNSZXR1cm5zLFxuXG5cdFx0W2s6IHN0cmluZ106IGFueSxcblx0fSA9IHtcblx0XHRjcDogbnVsbCxcblx0fTtcblxuXHRsZXQgbGFiZWw6IHN0cmluZztcblxuXHRjb25zb2xlLmluZm8oYGNyZWF0ZSBnaXQ6ICR7dGFyZ2V0TmFtZX1gKTtcblxuXHRpZiAob3B0aW9ucy5vbiAmJiBvcHRpb25zLm9uLmNyZWF0ZV9iZWZvcmUpXG5cdHtcblx0XHRsYWJlbCA9IGAtLS0gQ1JFQVRFX0JFRk9SRSAtLS1gO1xuXHRcdGNvbnNvbGUuaW5mbyhsYWJlbCk7XG5cdFx0Y29uc29sZS50aW1lKGxhYmVsKTtcblx0XHRvcHRpb25zLm9uLmNyZWF0ZV9iZWZvcmUoZGF0YSwgdGVtcCk7XG5cdFx0Y29uc29sZS50aW1lRW5kKGxhYmVsKTtcblx0fVxuXG5cdGxhYmVsID0gYC0tLSBDUkVBVEUgLS0tYDtcblx0Y29uc29sZS5pbmZvKGxhYmVsKTtcblx0Y29uc29sZS50aW1lKGxhYmVsKTtcblxuXHR0ZW1wLmNwID0gbnVsbDtcblxuXHRsZXQgX2RlbGV0ZWQ6IGJvb2xlYW47XG5cblx0aWYgKGRhdGEuTk9UX0RPTkUgJiYgZGF0YS5leGlzdHMpXG5cdHtcblx0XHRjb25zb2xlLndhcm4oYCR7dGFyZ2V0TmFtZX0gYWxyZWFkeSBleGlzdHNgKTtcblxuXHRcdHRlbXAuY3AgPSBmZXRjaEdpdChkYXRhLnRhcmdldFBhdGgpO1xuXHR9XG5cdGVsc2UgaWYgKGRhdGEuZXhpc3RzKVxuXHR7XG5cdFx0Y29uc29sZS53YXJuKGAke3RhcmdldE5hbWV9IGFscmVhZHkgZXhpc3RzYCk7XG5cblx0XHRjb25zb2xlLmluZm8oYOWPluW+l+aJgOaciemBoOerr+WIhuaUr2ApO1xuXHRcdGZldGNoR2l0QWxsKGRhdGEudGFyZ2V0UGF0aCk7XG5cblx0XHRfZGVsZXRlZCA9IGdpdFJlbW92ZUJyYW5jaE91dGRhdGUoZGF0YS50YXJnZXRQYXRoKTtcblxuXHRcdHRlbXAuY3AgPSBmZXRjaEdpdChkYXRhLnRhcmdldFBhdGgpO1xuXHR9XG5cdGVsc2Vcblx0e1xuXHRcdGxldCBDTE9ORV9ERVBUSDogbnVtYmVyID0gKG9wdGlvbnMuQ0xPTkVfREVQVEggfHwgcHJvY2VzcyAmJiBwcm9jZXNzLmVudiAmJiBwcm9jZXNzLmVudi5DTE9ORV9ERVBUSCB8fCA1MCkgYXMgbnVtYmVyO1xuXG5cdFx0aWYgKGlzTmFOKENMT05FX0RFUFRIKSB8fCAhQ0xPTkVfREVQVEggfHwgQ0xPTkVfREVQVEggPD0gMClcblx0XHR7XG5cdFx0XHRDTE9ORV9ERVBUSCA9IDUwO1xuXHRcdH1cblxuXHRcdGxldCB1cmxDbG9uZSA9IGRhdGEudXJsQ2xvbmU7XG5cblx0XHRpZiAoIXVybENsb25lKVxuXHRcdHtcblx0XHRcdGNvbnNvbGUucmVkKGB1cmxDbG9uZSDkuI3lrZjlnKgg5ZiX6Kmm6Ieq5YuV55Sf5oiQYCk7XG5cblx0XHRcdGlmIChkYXRhLkxPR0lOX1RPS0VOKVxuXHRcdFx0e1xuXHRcdFx0XHRjb25zb2xlLmRlYnVnKGDkvb/nlKggTE9HSU5fVE9LRU4g6Ieq5YuV55Sf5oiQIHVybENsb25lYCk7XG5cdFx0XHRcdHVybENsb25lID0gZ2V0UHVzaFVybChkYXRhLnVybCwgZGF0YS5MT0dJTl9UT0tFTik7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdGNvbnNvbGUuZGVidWcoYOS9v+eUqCB1cmwg6Ieq5YuV55Sf5oiQIHVybENsb25lYCk7XG5cdFx0XHRcdHVybENsb25lID0gZ2V0UHVzaFVybChkYXRhLnVybCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGVtcC5jcCA9IGNyb3NzU3Bhd25TeW5jKCdnaXQnLCBbXG5cdFx0XHQnY2xvbmUnLFxuXHRcdFx0YC0tZGVwdGg9JHtDTE9ORV9ERVBUSH1gLFxuXHRcdFx0Ly8nLS12ZXJib3NlJyxcblx0XHRcdC8vJy0tcHJvZ3Jlc3MgJyxcblx0XHRcdHVybENsb25lLFxuXHRcdFx0ZGF0YS50YXJnZXRQYXRoLFxuXHRcdF0sIHtcblx0XHRcdHN0ZGlvOiAnaW5oZXJpdCcsXG5cdFx0XHRjd2Q6IFBST0pFQ1RfUk9PVCxcblx0XHR9KTtcblx0fVxuXG5cdGxldCBfY3BfZXJyb3IgPSBnZXRDcm9zc1NwYXduRXJyb3IodGVtcC5jcCk7XG5cblx0aWYgKF9jcF9lcnJvcilcblx0e1xuXHRcdHRocm93IF9jcF9lcnJvclxuXHR9XG5cblx0aWYgKG9wdGlvbnMub24gJiYgb3B0aW9ucy5vbi5jcmVhdGUpXG5cdHtcblx0XHRvcHRpb25zLm9uLmNyZWF0ZShkYXRhLCB0ZW1wKTtcblx0fVxuXG5cdGNvbnNvbGUudGltZUVuZChsYWJlbCk7XG5cblx0aWYgKG9wdGlvbnMub24gJiYgb3B0aW9ucy5vbi5jcmVhdGVfYWZ0ZXIpXG5cdHtcblx0XHRsYWJlbCA9IGAtLS0gQ1JFQVRFX0FGVEVSIC0tLWA7XG5cdFx0Y29uc29sZS5pbmZvKGxhYmVsKTtcblx0XHRjb25zb2xlLnRpbWUobGFiZWwpO1xuXHRcdG9wdGlvbnMub24uY3JlYXRlX2FmdGVyKGRhdGEsIHRlbXApO1xuXHRcdGNvbnNvbGUudGltZUVuZChsYWJlbCk7XG5cdH1cblxuXHRsYWJlbCA9IGAtLS0gQkVGT1JFX0RPTkUgLS0tYDtcblx0Y29uc29sZS5pbmZvKGxhYmVsKTtcblx0Y29uc29sZS50aW1lKGxhYmVsKTtcblxuXHRpZiAoX2RlbGV0ZWQpXG5cdHtcblx0XHRnaXRHY0FnZ3Jlc3NpdmUoZGF0YS50YXJnZXRQYXRoKTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHRnaXRHYyhkYXRhLnRhcmdldFBhdGgpO1xuXHR9XG5cblx0Y29uc29sZS50aW1lRW5kKGxhYmVsKTtcblxuXHRsYWJlbCA9IGAtLS0gUkVNT1ZFX1dBSVQgLS0tYDtcblx0Y29uc29sZS5pbmZvKGxhYmVsKTtcblx0Y29uc29sZS50aW1lKGxhYmVsKTtcblxuXHR3YWl0X2NyZWF0ZV9naXQucmVtb3ZlKCk7XG5cblx0Y29uc29sZS50aW1lRW5kKGxhYmVsKTtcblxuXHRyZXR1cm4geyBkYXRhLCB0ZW1wIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdpdEdjKFJFUE9fUEFUSDogc3RyaW5nLCBhcmd2Pzogc3RyaW5nW10pXG57XG5cdGFyZ3YgPSBmaWx0ZXJBcmd2KFtcblx0XHQnZ2MnLFxuXHRdLmNvbmNhdCgoYXJndiAmJiBhcmd2Lmxlbmd0aCkgPyBhcmd2IDogW10pKTtcblxuXHRpZiAoYXJndi5sZW5ndGggPT0gMSlcblx0e1xuXHRcdGFyZ3YucHVzaCgnLS1wcnVuZT1cIjMgZGF5c1wiJyk7XG5cdH1cblxuXHRjb25zb2xlLmluZm8oYOWEquWMliBHSVQg6LOH5paZYCwgYXJndik7XG5cblx0cmV0dXJuIGNyb3NzU3Bhd25TeW5jKCdnaXQnLCBhcmd2LCB7XG5cdFx0Y3dkOiBSRVBPX1BBVEgsXG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnaXRHY0FnZ3Jlc3NpdmUoUkVQT19QQVRIOiBzdHJpbmcsIGFyZ3Y/OiBzdHJpbmdbXSlcbntcblx0YXJndiA9IGZpbHRlckFyZ3YoW1xuXHRcdCdnYycsXG5cdFx0Jy0tYWdncmVzc2l2ZScsXG5cdF0uY29uY2F0KChhcmd2ICYmIGFyZ3YubGVuZ3RoKSA/IGFyZ3YgOiBbXSkpO1xuXG5cdGlmIChhcmd2Lmxlbmd0aCA9PSAyKVxuXHR7XG5cdFx0YXJndi5wdXNoKCctLXBydW5lPVwiMyBkYXlzXCInKTtcblx0fVxuXG5cdGNvbnNvbGUuaW5mbyhg5YSq5YyWIEdJVCDos4fmlplgLCBhcmd2KTtcblxuXHRyZXR1cm4gY3Jvc3NTcGF3blN5bmMoJ2dpdCcsIGFyZ3YsIHtcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0XHRzdGRpbzogJ2luaGVyaXQnLFxuXHR9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJyYW5jaE5hbWVUb0RhdGUoYnJfbmFtZTogc3RyaW5nKVxue1xuXHRyZXR1cm4gbW9tZW50KGJyX25hbWUucmVwbGFjZSgvXi4qYXV0b1xcLy8sICcnKSwgREFURV9GT1JNQVQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnaXRSZW1vdmVCcmFuY2hPdXRkYXRlKFJFUE9fUEFUSDogc3RyaW5nKVxue1xuXHRjb25zb2xlLmluZm8oYOmWi+Wni+WIhuaekCBHSVQg5YiG5pSvYCk7XG5cblx0bGV0IGRhdGFfcmV0OiBib29sZWFuID0gZmFsc2U7XG5cblx0bGV0IGJyX25hbWUgPSBjdXJyZW50QnJhbmNoTmFtZShSRVBPX1BBVEgpLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcblxuXHRsZXQgZGF0ZV9iciA9IGJyYW5jaE5hbWVUb0RhdGUoYnJfbmFtZSk7XG5cdGxldCBkYXRlX25vdyA9IG1vbWVudCgpO1xuXG5cdC8vY29uc29sZS5sb2coe2JyX25hbWUsIGRhdGVfYnIsIGRhdGVfbm93fSk7XG5cblx0bGV0IGJyczogUmV0dXJuVHlwZTx0eXBlb2YgcGFyc2VCcmFuY2hHcm91cD47XG5cblx0YnJzID0gcGFyc2VCcmFuY2hHcm91cChnaXRCcmFuY2hNZXJnZWRMaXN0KFJFUE9fUEFUSCkpO1xuXG5cdGlmIChicnMpXG5cdHtcblx0XHRjb25zb2xlLmxvZyhg5qqi5p+l5Lim5Yiq6Zmk5bey5ZCI5L215YiG5pSvYCk7XG5cdFx0Y29uc29sZS5kaXIoYnJzLCB7IGNvbG9yczogdHJ1ZSwgfSk7XG5cblx0XHRsZXQgcHJlX25hbWU6IHN0cmluZztcblxuXHRcdHByZV9uYW1lID0gJ3JlZnMvaGVhZHMvJztcblxuXHRcdGJycy5oZWFkc1xuXHRcdFx0LmZvckVhY2goZnVuY3Rpb24gKHZhbHVlOiBzdHJpbmcsIGluZGV4LCBhcnJheSlcblx0XHRcdHtcblx0XHRcdFx0Zm4odmFsdWUsIHByZV9uYW1lICsgdmFsdWUpO1xuXHRcdFx0fSlcblx0XHQ7XG5cblx0XHRwcmVfbmFtZSA9ICdyZWZzL3JlbW90ZXMvJztcblxuXHRcdE9iamVjdC5rZXlzKGJycy5yZW1vdGVzKVxuXHRcdFx0LmZvckVhY2goZnVuY3Rpb24gKHJlbW90ZV9uYW1lKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgcHJlZml4ID0gcHJlX25hbWUgKyByZW1vdGVfbmFtZSArICcvJztcblxuXHRcdFx0XHRsZXQgYnJzX2xpc3QgPSBicnMucmVtb3Rlc1tyZW1vdGVfbmFtZV07XG5cblx0XHRcdFx0aWYgKGJyc19saXN0Lmxlbmd0aCA+IDUpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRicnNfbGlzdCA9IGJyc19saXN0XG5cdFx0XHRcdFx0XHQuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSlcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0bGV0IGJvb2wgPSAvYXV0b1xcLy9pLnRlc3QodmFsdWUpO1xuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBib29sO1xuXHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdC5zbGljZSgwLCAtMilcblx0XHRcdFx0XHQ7XG5cblx0XHRcdFx0XHRicnNfbGlzdFxuXHRcdFx0XHRcdFx0LmZvckVhY2goZnVuY3Rpb24gKHZhbHVlOiBzdHJpbmcsIGluZGV4LCBhcnJheSlcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0bGV0IGJvb2wgPSAhL2F1dG9cXC8vaS50ZXN0KHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0bGV0IGRlbF9uYW1lID0gcHJlZml4ICsgdmFsdWU7XG5cblx0XHRcdFx0XHRcdFx0Zm4odmFsdWUsIGRlbF9uYW1lLCBib29sLCB0cnVlLCByZW1vdGVfbmFtZSk7XG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdDtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHQ7XG5cdH1cblxuXHRicnMgPSBwYXJzZUJyYW5jaEdyb3VwKGdpdEJyYW5jaE1lcmdlZExpc3QoUkVQT19QQVRILCB0cnVlKSk7XG5cblx0aWYgKGJycylcblx0e1xuXHRcdGNvbnNvbGUubG9nKGDmqqLmn6XkuKbliKrpmaTmnKrlkIjkvbXpgY7mnJ/liIbmlK9gKTtcblx0XHRjb25zb2xlLmRpcihicnMsIHsgY29sb3JzOiB0cnVlLCB9KTtcblxuXHRcdGxldCBwcmVfbmFtZTogc3RyaW5nO1xuXG5cdFx0cHJlX25hbWUgPSAncmVmcy9oZWFkcy8nO1xuXG5cdFx0YnJzLmhlYWRzXG5cdFx0XHQuZm9yRWFjaChmdW5jdGlvbiAodmFsdWU6IHN0cmluZywgaW5kZXgsIGFycmF5KVxuXHRcdFx0e1xuXHRcdFx0XHRmbih2YWx1ZSwgcHJlX25hbWUgKyB2YWx1ZSk7XG5cdFx0XHR9KVxuXHRcdDtcblxuXHRcdHByZV9uYW1lID0gJ3JlZnMvcmVtb3Rlcy8nO1xuXG5cdFx0T2JqZWN0LmtleXMoYnJzLnJlbW90ZXMpXG5cdFx0XHQuZm9yRWFjaChmdW5jdGlvbiAocmVtb3RlX25hbWUpXG5cdFx0XHR7XG5cdFx0XHRcdGlmIChyZW1vdGVfbmFtZSA9PSAnb3JpZ2luJylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxldCBwcmVmaXggPSBwcmVfbmFtZSArIHJlbW90ZV9uYW1lICsgJy8nO1xuXG5cdFx0XHRcdGxldCBicnNfbGlzdCA9IGJycy5yZW1vdGVzW3JlbW90ZV9uYW1lXTtcblxuXHRcdFx0XHRpZiAoYnJzX2xpc3QubGVuZ3RoID4gNSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGxldCBtYXhfZGF0ZV91bml4ID0gMDtcblxuXHRcdFx0XHRcdGJyc19saXN0ID0gYnJzX2xpc3Rcblx0XHRcdFx0XHRcdC5maWx0ZXIoZnVuY3Rpb24gKHZhbHVlKVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRsZXQgYm9vbCA9IC9hdXRvXFwvL2kudGVzdCh2YWx1ZSk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGJvb2wpXG5cdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHRsZXQgZCA9IGJyYW5jaE5hbWVUb0RhdGUodmFsdWUpO1xuXG5cdFx0XHRcdFx0XHRcdFx0Ly9jb25zb2xlLmxvZyhkLCBkLnVuaXgoKSk7XG5cblx0XHRcdFx0XHRcdFx0XHRtYXhfZGF0ZV91bml4ID0gTWF0aC5tYXgobWF4X2RhdGVfdW5peCwgZC51bml4KCkpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIGJvb2w7XG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0LnNsaWNlKDAsIC0zKVxuXHRcdFx0XHRcdDtcblxuXHRcdFx0XHRcdGxldCBtYXhfZGF0ZSA9IG1vbWVudC51bml4KG1heF9kYXRlX3VuaXgpO1xuXG5cdFx0XHRcdFx0YnJzX2xpc3Rcblx0XHRcdFx0XHRcdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZTogc3RyaW5nLCBpbmRleCwgYXJyYXkpXG5cdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdGxldCBib29sID0gIS9eYXV0b1xcLy9pLnRlc3QodmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRsZXQgZGVsX25hbWUgPSBwcmVmaXggKyB2YWx1ZTtcblxuXHRcdFx0XHRcdFx0XHRmbih2YWx1ZSwgZGVsX25hbWUsIGJvb2wsIHRydWUsIHJlbW90ZV9uYW1lKTtcblx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0O1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdDtcblx0fVxuXG5cdGZ1bmN0aW9uIGZuKHZhbHVlOiBzdHJpbmcsIGRlbF9uYW1lOiBzdHJpbmcsIHNraXA/OiBib29sZWFuLCBpc19yZW1vdGU/OiBib29sZWFuLCByZW1vdGVfbmFtZT86IHN0cmluZylcblx0e1xuXHRcdGxldCB2YWx1ZV9sYyA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG5cblx0XHRpZiAoc2tpcClcblx0XHR7XG5cdFx0XHRjb25zb2xlLmxvZyhgc2tpcCAoMSkgJHtkZWxfbmFtZX1gKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0ZWxzZSBpZiAoIXZhbHVlIHx8IHZhbHVlX2xjID09IGJyX25hbWUgfHwgdmFsdWVfbGMgPT0gJ21hc3RlcicgfHwgdmFsdWVfbGMgPT0gJ2hlYWQnKVxuXHRcdHtcblx0XHRcdGNvbnNvbGUubG9nKGBza2lwICgyKSAke2RlbF9uYW1lfWApO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRlbHNlIGlmIChpc19yZW1vdGUpXG5cdFx0e1xuXHRcdFx0aWYgKCEvYXV0b1xcLy9pLnRlc3QodmFsdWUpIHx8ICFyZW1vdGVfbmFtZSlcblx0XHRcdHtcblx0XHRcdFx0Y29uc29sZS5sb2coYHNraXAgKDMpICR7ZGVsX25hbWV9YCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0bGV0IGQgPSBtb21lbnQodmFsdWUucmVwbGFjZSgvXi4qYXV0b1xcLy8sICcnKSwgREFURV9GT1JNQVQpO1xuXG5cdFx0XHQvL2NvbnNvbGUubG9nKGQpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUuaW5mbyhgdHJ5IGRlbGV0ZSAke2RlbF9uYW1lfWApO1xuXG5cdFx0aWYgKGlzX3JlbW90ZSlcblx0XHR7XG5cdFx0XHRkZWxldGVCcmFuY2hSZW1vdGUoUkVQT19QQVRILCByZW1vdGVfbmFtZSwgdmFsdWUpO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0ZGVsZXRlQnJhbmNoKFJFUE9fUEFUSCwgdmFsdWUpO1xuXHRcdH1cblxuXHRcdGRhdGFfcmV0ID0gdHJ1ZTtcblx0fVxuXG5cdHJldHVybiBkYXRhX3JldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdpdEJyYW5jaE1lcmdlZExpc3QoUkVQT19QQVRIOiBzdHJpbmcsIG5vTWVyZ2VkPzogYm9vbGVhbiwgQlJfTkFNRT86IHN0cmluZylcbntcblx0bGV0IGNwID0gY3Jvc3NTcGF3blN5bmMoJ2dpdCcsIGZpbHRlckFyZ3YoW1xuXHRcdCdicmFuY2gnLFxuXHRcdCctLWZvcm1hdCcsXG5cdFx0JyUocmVmbmFtZSknLFxuXHRcdCctYScsXG5cdFx0bm9NZXJnZWQgPyAnLS1uby1tZXJnZWQnIDogJy0tbWVyZ2VkJyxcblx0XHRCUl9OQU1FLFxuXHRdKSwge1xuXHRcdGN3ZDogUkVQT19QQVRILFxuXHR9KTtcblxuXHRpZiAoY3Auc3RkZXJyICYmIGNwLnN0ZGVyci5sZW5ndGgpXG5cdHtcblx0XHRjb25zb2xlLmVycm9yKGNwLnN0ZGVyci50b1N0cmluZygpKTtcblxuXHRcdHJldHVybiBudWxsXG5cdH1cblxuXHRsZXQgbmFtZSA9IGNyb3NzU3Bhd25PdXRwdXQoY3Auc3Rkb3V0KTtcblxuXHRyZXR1cm4gbmFtZVxuXHRcdC5zcGxpdChMRilcblx0XHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJBcmd2KGFyZ3Y6IHN0cmluZ1tdKVxue1xuXHRyZXR1cm4gYXJndlxuXHRcdC5maWx0ZXIodiA9PiB0eXBlb2YgdiAhPT0gJ3VuZGVmaW5lZCcpXG5cdFx0Lm1hcCh2ID0+IHYudHJpbSgpKVxuXHRcdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQnJhbmNoR3JvdXAocjogc3RyaW5nW10pOiB7XG5cdGhlYWRzOiBzdHJpbmdbXTtcblx0cmVtb3Rlczoge1xuXHRcdG9yaWdpbjogc3RyaW5nW107XG5cdFx0W2s6IHN0cmluZ106IHN0cmluZ1tdO1xuXHR9O1xufVxue1xuXHRpZiAoIXIgfHwgIXIubGVuZ3RoKVxuXHR7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gci5zb3J0KCkucmVkdWNlKGZ1bmN0aW9uIChhLCBiKVxuXHR7XG5cdFx0aWYgKC9ecmVmc1xcL3JlbW90ZXNcXC8oW15cXC9dKylcXC8oLispJC8uZXhlYyhiKSlcblx0XHR7XG5cdFx0XHRsZXQgeyAkMSwgJDIgfSA9IFJlZ0V4cDtcblx0XHRcdGEucmVtb3Rlc1skMV0gPSBhLnJlbW90ZXNbJDFdIHx8IFtdO1xuXHRcdFx0YS5yZW1vdGVzWyQxXS5wdXNoKCQyKTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAoL15yZWZzXFwvaGVhZHNcXC8oLispJC8uZXhlYyhiKSlcblx0XHR7XG5cdFx0XHRsZXQgeyAkMSwgJDIgfSA9IFJlZ0V4cDtcblx0XHRcdGEuaGVhZHMucHVzaCgkMSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGE7XG5cdH0sIHtcblx0XHRoZWFkczogW10sXG5cdFx0cmVtb3Rlczoge1xuXHRcdFx0b3JpZ2luOiBbXSxcblx0XHR9LFxuXHR9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2l0Q2xlYW5BbGwoUkVQT19QQVRIOiBzdHJpbmcpXG57XG5cdGNvbnNvbGUuaW5mbyhgW2dpdDpjbGVhbl0gUmVtb3ZlIHVudHJhY2tlZCBmaWxlcyBmcm9tIHRoZSB3b3JraW5nIHRyZWVgKTtcblx0cmV0dXJuIGNyb3NzU3Bhd25TeW5jKCdnaXQnLCBbXG5cdFx0J2NsZWFuJyxcblx0XHQnLWQnLFxuXHRcdCctZngnLFxuXHRdLCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IFJFUE9fUEFUSCxcblx0fSk7XG59XG4iXX0=